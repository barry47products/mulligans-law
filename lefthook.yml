# Lefthook Git Hooks Configuration
# https://github.com/evilmartians/lefthook

# Pre-commit: Run before commits are created
pre-commit:
  parallel: true
  commands:
    # Format Dart code
    format:
      glob: "*.dart"
      run: dart format {staged_files}
      stage_fixed: true

    # Analyze Dart code for issues
    analyze:
      run: flutter analyze
      fail_text: "Flutter analyze found issues. Please fix them before committing."

    # Run tests (optional - can be slow)
    # Uncomment if you want to run tests on every commit
    # test:
    #   run: flutter test
    #   fail_text: "Tests failed. Please fix them before committing."

# Commit-msg: Validate commit message format
commit-msg:
  commands:
    # Enforce conventional commit format
    conventional-commit:
      run: |
        MSG=$(cat {1})
        PATTERN="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,100}"
        if ! echo "$MSG" | grep -qE "$PATTERN"; then
          echo "‚ùå Invalid commit message format!"
          echo ""
          echo "Commit message must follow Conventional Commits format:"
          echo "  <type>(<scope>): <subject>"
          echo ""
          echo "Types: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert"
          echo "Example: feat(auth): add login screen"
          echo "Example: fix(scores): correct calculation logic"
          exit 1
        fi
